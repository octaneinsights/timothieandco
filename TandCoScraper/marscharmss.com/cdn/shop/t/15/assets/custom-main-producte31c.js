var screen_width=window.innerWidth,screen_height=window.innerHeight,device_type;screen_width<=767?device_type="Phone":screen_width>767&&screen_width<=1024?device_type="tablet":device_type="PC";var charms_data=$(".charms_div").clone();$(".charms_div").remove(),document.addEventListener("DOMContentLoaded",function(){$(".necklace-btn").click()});var current_tab;function openCity(evt,tab_name){$(".tablink:first").addClass("w3-red"),current_tab=tab_name,$(".loader").hide();var i2,x,tablinks;for(x=document.getElementsByClassName("city"),i2=0;i2<x.length;i2++)x[i2].style.display="none";for(tablinks=document.getElementsByClassName("tablink"),i2=0;i2<x.length;i2++)tablinks[i2].className=tablinks[i2].className.replace(" w3-red","");document.getElementById(tab_name).style.display="block",evt.currentTarget.className+=" w3-red",summary()}const items=document.querySelectorAll(".accordion button");function toggleAccordion(){summary();const itemToggle=this.getAttribute("aria-expanded");for(i=0;i<items.length;i++)items[i].setAttribute("aria-expanded","false");itemToggle=="false"&&this.setAttribute("aria-expanded","true")}items.forEach(item=>item.addEventListener("click",toggleAccordion)),$(".button-design").on("click",function(event,element){$(".size-select-section").hide(),$(".placements_div .choose-product-design").children().removeClass("active"),$(".placements-number").hide(),$(".minimal").html(""),$(".product-choose").show(),$(".button-design").removeClass("active"),$(".chain").removeClass("active"),$(".placements_setter").val(0),$(".placements_holder").hide(),$(".placements_div").hide(),$("#load_more").hide(),$.each(current_charm,function(index,value){value.remove()}),$(this).addClass("active"),$(this).hasClass("necklace-btn")?($(".necklace").show(),$(".bracelet").hide()):($(".bracelet").show(),$(".necklace").hide()),setTimeout(function(){summary()},200)}),$(".chain").on("click",function(){$(".placements-number").hide(),$(".size-select-section").show(),$(".chain").removeClass("active"),$(this).addClass("active");var chain_image=$(this).find("img").attr("src").trim();draw_konva(chain_image),$(".minimal").html("<option>Loading...</option>");var product_handle=$(this).attr("product-handle");jQuery.getJSON(`/products/${product_handle}.js`,function(product){$(".minimal").html("");var variants=product.variants;$.each(variants,function(index,value){var price=value.price/100;if(value.available!=!1){var variant_name="";value.title=="Default Title"?variant_name=product.title:variant_name=value.title,$(".minimal").append(`<option variant-id="${value.id}" price="${price.toFixed(2)}">${variant_name} - $ ${price.toFixed(2)} USD</option>`)}}),$(".placements-number").show()}),setTimeout(function(){summary()},500),$.each(current_charm,function(index,value){value.remove()})});function setplacements(element){$.each(current_charm,function(index,value){value.remove()}),$("#load_more").hide(),$(".placements_div").show(),$(".placements_holder").show();var number_of_placements=$(element).val();$(".placements_holder").html(""),$(".placements_div").html("");for(var i2=0;i2<number_of_placements;i2++)$(".placements_holder").append(`  <button class="tablink" onmousedown="$('.loader').show();" onclick="openCity(event,'p${i2+1}');">Charm ${i2+1}</button>`),$(".placements_div").append(`<div id="p${i2+1}" class="w3-container city tab-content" style="display:none;">
      <div class="product-choose">
      
    <p class="product-heading-ver">Charm ${i2+1}</p>
    <div class="choose-product-design p${i2+1}"
      
    style="/*height:680px; overflow:hidden;*/"
    
    >
  
${charms_data.html()}
        
      </div>
    </div>
  </div>

      
    </div>`);var selected_charms_array=[];$(".charm.product").on("click",function(){var charm_image=$(this).find("img").attr("src").trim();if($(this).parents(".choose-product-design").children().not(this).hasClass("active")){var previous_charm;$(this).parents(".choose-product-design").children().not(this).each(function(index,value){var classlist=$(value)[0].classList;classlist[2]=="active"&&(previous_charm=$(value))});var previous_variant_id=previous_charm.attr("default-variant-id");selected_charms_array.length>0&&selected_charms_array.forEach(function(value,index){if(value.hasOwnProperty(previous_variant_id)){var current_quantity=value[previous_variant_id];current_quantity>0&&current_quantity--,value[previous_variant_id]=current_quantity}}),$(this).parents(".choose-product-design").children().not(this).removeClass("active")}var current_variant_id=$(this).attr("default-variant-id"),current_inventory=$(this).attr("qty");$(this).toggleClass("active");var element2=this;$(this).hasClass("active")?(selected_charms_array.length>0&&selected_charms_array.forEach(function(value,index){if(value.hasOwnProperty(current_variant_id)){var current_quantity=value[current_variant_id];current_quantity<current_inventory?current_quantity++:($(".inventory_error").html(`(Inventory quantity limit reached for ${$(element2).attr("title")})`),setTimeout(function(){$(".inventory_error").html("")},3e3),console.log("Inventory quantity limit reached"),$(element2).removeClass("active"),current_charm[current_tab].remove()),value[current_variant_id]=current_quantity}}),add_charm(charm_image)):(selected_charms_array.length>0&&selected_charms_array.forEach(function(value,index){if(value.hasOwnProperty(current_variant_id)){var current_quantity=value[current_variant_id];current_quantity>0&&current_quantity--,value[current_variant_id]=current_quantity}}),current_charm[current_tab].remove());var variant_found_flag=0;if(selected_charms_array.forEach(function(value,index){value.hasOwnProperty(current_variant_id)&&(variant_found_flag=1)}),variant_found_flag==0){var tempObj={};tempObj[current_variant_id]=1;var qty=0;fetch("/cart.js").then(item=>item.json()).then(item=>{item.items.forEach(function(value,index){current_variant_id==value.id&&(qty+=value.quantity)}),qty<current_inventory?tempObj[current_variant_id]=qty+1:(tempObj[current_variant_id]=qty,$(".inventory_error").html(`(Inventory quantity limit reached for ${$(element2).attr("title")})`),setTimeout(function(){$(".inventory_error").html("")},3e3),console.log("Inventory quantity limit reached"),$(element2).removeClass("active"),current_charm[current_tab].remove()),selected_charms_array.push(tempObj)})}setTimeout(function(){console.log(selected_charms_array)},500),setTimeout(function(){summary(),$(element2).hasClass("active")==!1&&current_charm[current_tab].remove()},200)})}function load_more(element){$(element).hasClass("loaded")?($(`.choose-product-design.${current_tab}`).animate({height:"680px"}),$(element).removeClass("loaded")):($(`.choose-product-design.${current_tab}`).animate({height:"100%"}),$(element).addClass("loaded"))}function summary(){var selected_charms=[],selected_chain=$(".chain.active .tooltip").text().trim(),selected_size=$(".minimal option:selected").text(),selected_size_id=$(".minimal option:selected").attr("variant-id"),selected_size_price=$(".minimal option:selected").attr("price"),charms_price=0;$(".placements_div .choose-product-design").each(function(index,value){if($(value).children().hasClass("active")){var selected_charm_price=$(value).children(".active").attr("price");charms_price+=parseFloat(selected_charm_price);var selected_charm_variant_id=$(value).children(".active").attr("default-variant-id"),selected_charm=`<span class="item" item-type='charm' placement='${index+1}' selected_variant_id='${selected_charm_variant_id}'><b>Charm ${index+1}</b> - ${$(value).children(".active").find(".tooltip").text().trim()}</span>`;selected_charms.push(selected_charm)}});var charms_html="";$("#summary_title").html("<b>Selected Chain</b>: "+selected_chain),$("#summary_variant").html("<b>Selected Size</b>: "+selected_size),$("#summary_variant").attr("selected_variant_id",selected_size_id),$.each(selected_charms,function(index,value){charms_html+=`<div>${value}</div>`}),$("#summary_charms").html(charms_html);var total_price=parseFloat(selected_size_price)+parseFloat(charms_price);total_price&&$("#summary_total_price").html('<b>Total Price</b>: $<span id="totes">'+total_price.toFixed(2)+"</span> USD")}function reset(){$(".size-select-section").hide(),$(".placements_div .choose-product-design").children().removeClass("active"),$(".placements-number").hide(),$(".minimal").html(""),$(".chain").removeClass("active"),$(".placements_setter").val(0),$(".placements_holder").hide(),$(".placements_div").hide(),$("#summary").hide(""),$(".necklace-btn").click(),summary(),$("textarea").val(""),$("#summary_order_note").html(""),document.querySelector(".accordion button").setAttribute("aria-expanded","false"),$("#load_more").hide(),$.each(current_charm,function(index,value){value.remove()})}var currentTime=new Date().getTime(),uniqueId="Uni_"+currentTime+"_"+Math.floor(Math.random()*1e3);function add_me(){$(".necklace.product.chain.active").length>0||$(".bracelet.product.chain.active").length>0?console.log("Added to cart!"):($("#selection_para").css("display","block"),setTimeout(function(){$("#selection_para").css("display","none")},5e3));var dataURL=stage.toDataURL(),img=new Image;img.src=dataURL,localStorage.setItem(uniqueId,img.src);var myObject={};myObject.Custom=uniqueId,$("#summary_charms .item").each(function(index,value){var placement=$(this).attr("placement"),placement_text=$(this).text().trim(),farts=placement_text.split("- "),resultking=farts.slice(1).join("- "),key="Charm "+placement,value=resultking;myObject[key]=value});var data=[];$(".item").each(function(){if($(this).attr("item-type")=="charm")var placement=$(this).attr("placement"),variant={quantity:1,id:$(this).attr("selected_variant_id"),properties:{Custom:uniqueId,"Charm Number":placement,Addon:"Charm"}};else var variant={quantity:1,id:$(this).attr("selected_variant_id"),properties:{Custom:uniqueId,Addon:"Chain"}};data.push(variant)});var chain_name=$("#summary_title").text().replace("Selected Chain: ",""),chain_var_name=$('.item[item-type="chain"]').text().replace("Selected Size: ",""),final_chain=chain_name+" "+chain_var_name,total_amount=$("#totes").html();$.ajax({type:"POST",url:"https://store.marscharmss.com/test.php",data:{base64string:img.src,image_name:uniqueId+".jpg"},success:function(response){try{var jsonResponse=typeof response=="string"?JSON.parse(response):response;if(jsonResponse.success){myObject.Chain=final_chain,myObject.Total=total_amount;var text=$("#summary_order_note").text(),liberty=$("#summary_creative_liberty").text();text=text.replace("Order Note: ",""),liberty=liberty.replace("Creative Liberty:",""),myObject["Order Note"]=text,myObject["Creative Liberty"]=liberty,myObject["Image URL"]=jsonResponse.image_url;var custom_product={quantity:1,id:47413636596029,properties:myObject};data.push(custom_product),console.log(data),add_to_cart(data,img.src)}else console.error("Image upload failed:",jsonResponse.error)}catch(error){console.error("Error parsing response:",error,response)}},error:function(xhr,status,error){console.error("AJAX error:",status,error)}})}async function add_to_cart(data,img){jQuery.ajax({type:"POST",url:"/cart/add.js",data:{items:data},dataType:"json",success:function(){window.location.replace("/cart")}})}var layer=new Konva.Layer,main_chain_img,stage;function draw_konva(main_image){stage=new Konva.Stage({container:"container",width:device_type=="Phone"?window.innerWidth:device_type=="tablet"?window.innerWidth/2:630,height:device_type=="Phone"?380:630}),main_chain_img?.remove(),stage.add(layer);var mainImage=new Image;mainImage.src=main_image,mainImage.onload=function(){var mainImageKonva=new Konva.Image({x:0,y:0,image:mainImage,width:device_type=="Phone"?350:device_type=="tablet"?400:600,height:device_type=="Phone"?350:device_type=="tablet"?400:600});main_chain_img=mainImageKonva,layer.add(mainImageKonva),mainImageKonva.on("click",function(){var pointerPos=stage.getPointerPosition(),x=pointerPos.x,y=pointerPos.y;console.log("x: "+x+", y: "+y)})}}var current_charm={};function add_charm(charm_image){$.isEmptyObject(current_charm)==!1&&current_charm[current_tab]!=null&&current_charm[current_tab].remove();var x,y;current_tab=="p1"?(x=-40,y=55):current_tab=="p2"?(x=100,y=47):current_tab=="p3"?(x=152,y=250):current_tab=="p4"?(x=27,y=230):current_tab=="p5"?(x=100,y=210):current_tab=="p6"?(x=-24,y=180):current_tab=="p7"?(x=100,y=160):current_tab=="p8"?(x=150,y=150):current_tab=="p9"?(x=200,y=150):current_tab=="p10"?(x=250,y=150):current_tab=="p11"?(x=300,y=150):current_tab=="p12"?(x=309,y=150):current_tab=="p13"?(x=310,y=150):current_tab=="p14"?(x=311,y=150):current_tab=="p15"&&(x=312,y=150);var overlayImage1=new Image;overlayImage1.src=charm_image,overlayImage1.onload=function(){var overlayImageKonva1=new Konva.Image({x,y,image:overlayImage1,width:150,height:150,draggable:!0});device_type=="PC"?overlayImageKonva1.on("dragmove",()=>{overlayImageKonva1.y(Math.max(overlayImageKonva1.y(),-50)),overlayImageKonva1.x(Math.max(overlayImageKonva1.x(),-50)),overlayImageKonva1.y(Math.min(overlayImageKonva1.y(),500)),overlayImageKonva1.x(Math.min(overlayImageKonva1.x(),450))}):device_type=="tablet"?overlayImageKonva1.on("dragmove",()=>{overlayImageKonva1.y(Math.max(overlayImageKonva1.y(),-50)),overlayImageKonva1.x(Math.max(overlayImageKonva1.x(),-50)),overlayImageKonva1.y(Math.min(overlayImageKonva1.y(),350)),overlayImageKonva1.x(Math.min(overlayImageKonva1.x(),300))}):overlayImageKonva1.on("dragmove",()=>{overlayImageKonva1.y(Math.max(overlayImageKonva1.y(),0)),overlayImageKonva1.x(Math.max(overlayImageKonva1.x(),-80)),overlayImageKonva1.y(Math.min(overlayImageKonva1.y(),380)),overlayImageKonva1.x(Math.min(overlayImageKonva1.x(),380))}),layer.add(overlayImageKonva1),current_charm[current_tab]=overlayImageKonva1,layer.draw()}}$(document).ready(function(){var isFirstClick=!0;$("#order_note").on("click",function(){isFirstClick&&($(this).select(),isFirstClick=!1)}),$("#order_note").on("keyup",function(){$("#summary_order_note").html("<b>Order Note: </b>"+$(this).val())})}),$("#creative_liberty").on("change",function(){$(this).is(":checked")?$("#summary_creative_liberty").html("<b>Creative Liberty: </b><span>Allowed</span>"):$("#summary_creative_liberty").html("<b>Creative Liberty: </b><span>Not Allowed</span>")});
//# sourceMappingURL=/cdn/shop/t/15/assets/custom-main-product.js.map?v=52135109017790080441739376991
